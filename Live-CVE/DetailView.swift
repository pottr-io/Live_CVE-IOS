import SwiftUI

struct DetailView: View {
    let cve: CVE?
    
    var body: some View {
        ScrollView {
            if let cve = cve {
                VStack(alignment: .leading) {
                    ForEach(propertyTexts(cve: cve)) { property in
                        PropertyCell(property: property)
                    }
                }
                .padding()
            } else {
                Text("No CVE details available.")
            }
        }
        .navigationTitle("CVE Details")
    }
    
    func propertyTexts(cve: CVE) -> [Property] {
        return [
            Property(name: "CVE ID:", value: cve.id),
            Property(name: "Description:", value: cve.description),
            Property(name: "Last Modified:", value: cve.lastModifiedDate),
            Property(name: "Published Date:", value: cve.publishedDate),
            Property(name: "Data Timestamp:", value: cve.data_timestamp),
            Property(name: "Reference URL:", value: cve.reference_url),
            Property(name: "Reference Source:", value: cve.reference_source),
            Property(name: "Reference Tags:", value: cve.reference_tags),
            Property(name: "Version:", value: cve.version),
            Property(name: "Vector String:", value: cve.vectorString),
            Property(name: "Attack Vector:", value: cve.attackVector),
            Property(name: "Attack Complexity:", value: cve.attackComplexity),
            Property(name: "Privileges Required:", value: cve.privilegesRequired),
            Property(name: "User Interaction:", value: cve.userInteraction),
            Property(name: "Scope:", value: cve.scope),
            Property(name: "Confidentiality Impact:", value: cve.confidentialityImpact),
            Property(name: "Integrity Impact:", value: cve.integrityImpact),
            Property(name: "Availability Impact:", value: cve.availabilityImpact),
            Property(name: "Base Score:", value: cve.baseScore),
            Property(name: "Base Severity:", value: cve.baseSeverity),
            Property(name: "Comment:", value: cve.comment_text ?? ""),
            Property(name: "Timestamp:", value: cve.timestamp ?? "")
        ]
    }
}


struct PropertyCell: View {
    let property: Property
    
    var body: some View {
        HStack {
            Text(property.name)
                .font(.body)
                .fontWeight(.bold)
                
            Spacer()
            
            // Add the copy functionality to the value text
            Text(property.value)
                .modifier(BaseScoreColor(baseScore: property.value))
                .contextMenu {
                    Button(action: {
                        // Copy the property value to the clipboard
                        UIPasteboard.general.string = property.value
                    }) {
                        Text("Copy")
                        Image(systemName: "doc.on.doc")
                    }
                }
        }
        .padding(.vertical, 2)
    }
}

struct BaseScoreColor: ViewModifier {
    let baseScore: String

    func body(content: Content) -> some View {
        let score = Double(baseScore) ?? 0.0
        switch score {
        case ..<5:
            return content.foregroundColor(Color.green)
        case 5...8:
            return content.foregroundColor(Color.yellow)
        default:
            return content.foregroundColor(Color.red)
        }
    }
}

struct Property: Hashable, Identifiable {
    let id = UUID()
    let name: String
    let value: String
}
